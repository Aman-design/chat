
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <%
    user_id = 1
    user_hash = OpenSSL::HMAC.hexdigest(
      'sha256',
      @web_widget.hmac_token,
      user_id.to_s
    )

  %>
  <script>
    window.chatwootSettings = {
      hideMessageBubble: false,
      position: '<%= @widget_position %>',
      locale: 'en',
      type: '<%= @widget_type %>',
      showPopoutButton: true,
      widgetStyle: '<%= @widget_style %>',
    };

    window.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded');
      var BASE_URL = '';
      window.chatwootSDK.run({
        websiteToken: '<%= @web_widget.website_token %>',
        baseUrl: BASE_URL
      })
    })

    window.addEventListener('chatwoot:ready', function() {
      console.log('chatwoot:ready', window.$chatwoot);
      if (window.location.search.includes('setUser')) {
        window.$chatwoot.setUser('<%= user_id %>', {
          identifier_hash: 'a<%= user_hash %>',
          email: 'jane@example.com',
          name: 'Jane Doe',
          phone_number: ''
        });
      }
    })

    window.addEventListener('chatwoot:error', function(e) {
      console.log('chatwoot:error', e.details)
    })
  </script>

  <%= vite_client_tag %>
  <%= vite_javascript_tag 'sdk' %>
</head>
</html>
